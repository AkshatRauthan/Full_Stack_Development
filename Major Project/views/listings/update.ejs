<% layout('/layouts/boilerplate') %>

<body >
    <h2 class="mt-3 offset-2">Edit Your Listing</h2><br>

    <form method="post" action="/listings/<%= listing._id%>?_method=PUT" class="needs-validation offset-2" novalidate
        id = "listing-form" enctype="multipart/form-data">

        <div class="mb-4">
            <label for="listing[title]" class="form-label" >Title : </label>&nbsp;
            <input name="listing[title]" class="form-control" type="text" value="<%=listing.title%>"
                placeholder="Enter The Title Of The Listing" required>
            <div class="valid-feedback"> Looks Good! </div>
            <div class="invalid-feedback">
                <div class="input-feedback"><i class="material-symbols-outlined">error</i>
                    &nbsp; Please Enter A Valid Title</div>
            </div>
        </div>

        <div class="mb-4">
            <label for="listing[description]" class="form-label" >Description : </label>&nbsp;&nbsp;
            <textarea name="listing[description]" class="form-control" rows="2" cols="27" 
            placeholder="Enter The Description" required><%=listing.description %></textarea>
            <div class="valid-feedback"> Looks Good! </div>
            <div class="invalid-feedback">
                <div class="input-feedback"><i class="material-symbols-outlined">error</i>
                    &nbsp; Please Enter A Valid Description</div>
            </div>
        </div>

        <div class="mb-3">
            Original Listing Image : <br>
            <img src="<%= url %>" class="mt-2 mb-4 preview-image">
        </div>

        <div class="mb-4">
            <label for="listing[image]" class="form-label" > Upload Image If You Want To Change It : </label>&nbsp;
            <input name="listing[image]" class="form-control" type="file">
            <div class="valid-feedback"> Looks Good! </div>
        </div>

        <div class="mb-4">
            <!-- Multi-select dropdown for professions -->
            <label for="" class="form-label">Tags : </label><br>
            <div class="dropdown-container">
                <div class="dropdown-button" onmouseenter="toggleDropdown()" onclick="toggleDropdown()"></div>
                <div class="selected-values" id="selectedValues">No tags chosen</div>
            </div>
            <script>
                const tagsData = <%- JSON.stringify(tagsData) %>;
            </script>
            
            <!-- Custom dropdown options -->
            <div id="dropdown">
                <!-- Options will be added dynamically -->
            </div>
        </div>

        <div class="row">
            <div class="mb-4 col-md-5">
                <label for="listing[price]" class="form-label" >Price : </label>&nbsp;
                <input name="listing[price]" class="form-control" type="number" value="<%=listing.price%>"
                placeholder="Enter The Price Per Night" required>
                <div class="valid-feedback"> Looks Good! </div>
                <div class="invalid-feedback">
                    <div class="input-feedback"><i class="material-symbols-outlined">error</i>
                        &nbsp; Please Enter A Valid Price</div>
                </div>
            </div>

            <div class="mb-4 col-md-7">
                <label for="listing[location]" class="form-label" >Location : </label>&nbsp;
                <input name="listing[location]"  class="form-control" type="text" value="<%=listing.location%>"
                placeholder="Enter The Location Of The Listing" required>
                <div class="valid-feedback"> Looks Good! </div>
                <div class="invalid-feedback">
                    <div class="input-feedback"><i class="material-symbols-outlined">error</i>
                        &nbsp; Please Enter A Valid Location</div>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <label class="form-label" for="listing[country]">Country : </label>&nbsp;
            <input class="form-control" type="text" name="listing[country]" value="<%=listing.country%>"
            placeholder="Enter The Country of the Location" required>
            <div class="valid-feedback"> Looks Good! </div>
            <div class="invalid-feedback">
                <div class="input-feedback"><i class="material-symbols-outlined">error</i>
                    &nbsp; Please Enter A Valid Country</div>
            </div>
        </div>

        <button class="btn btn-dark mb-5 mt-4 btn-edit" type="submit">Edit</button>&nbsp;&nbsp;
        <button class="btn btn-dark mb-5 mt-4 btn-edit" type="reset">Reset</button> 

        <script>
            const isUpdateForm = true;
            const existingTags = <%- JSON.stringify(listing.tags.map(tag => tag.tagName)) %>;
        </script>
        <script src="/js/listingFormHandlers.js"></script>
    </form>
</body>